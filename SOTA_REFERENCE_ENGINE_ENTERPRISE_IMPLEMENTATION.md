# SOTA REFERENCE ENGINE - ENTERPRISE IMPLEMENTATION\n\n## STATUS: STEP 1 COMPLETE âœ…\n\nStep 1: Import statement added to services.tsx line 26\n```typescript\nimport { detectCategory, generateReferenceHTML, REFERENCE_CATEGORIES } from './reference-engine';\n```\n\n## STEP 2: UPDATE fetchVerifiedReferences() - CODE REPLACEMENT\n\nLOCATION: services.tsx, around line 87\n\nREPLACE THE ENTIRE FUNCTION:\n\n```typescript\nconst fetchVerifiedReferences = async (\n  keyword: string,\n  semanticKeywords: string[],\n  serperApiKey: string,\n  wpUrl?: string\n): Promise<string> => {\n  if (!serperApiKey) return \"\";\n  \n  try {\n    // SOTA ENHANCEMENT: Detect category from keywords\n    const category = detectCategory(keyword, semanticKeywords);\n    const categoryConfig = REFERENCE_CATEGORIES[category];\n    const currentYear = new Date().getFullYear();\n    \n    console.log(`[fetchVerifiedReferences] Category detected: ${category}`)\n    \n    let userDomain = \"\";\n    if (wpUrl) {\n      try { userDomain = new URL(wpUrl).hostname.replace('www.', ''); } catch(e) {}\n    }\n\n    // SOTA ENHANCEMENT: Build topic-aware search using category config\n    let query: string;\n    if (categoryConfig) {\n      const modifiers = categoryConfig.searchModifiers.slice(0, 2).join(' OR ');\n      const domainFilters = categoryConfig.authorityDomains\n        .slice(0, 3)\n        .map(d => `site:${d}`)\n        .join(' OR ');\n      query = `${keyword} \"${modifiers}\" (${domainFilters}) ${currentYear}`;\n    } else {\n      query = `${keyword} \"research\" \"data\" \"statistics\" ${currentYear} -site:youtube.com -site:reddit.com`;\n    }\n\n    const response = await fetchWithProxies(\"https://google.serper.dev/search\", {\n      method: \"POST\",\n      headers: { \"X-API-KEY\": serperApiKey, \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ q: query, num: 20 }),\n    });\n\n    const data = await response.json();\n    const potentialLinks = data.organic || [];\n    const validLinks: any[] = [];\n\n    for (const link of potentialLinks) {\n      if (validLinks.length >= 8) break;\n\n      try {\n        const urlObj = new URL(link.link);\n        const domain = urlObj.hostname.replace(\"www.\", \"\");\n\n        if (domain.includes(userDomain)) continue;\n        if ([\"linkedin.com\", \"facebook.com\"].some(d => domain.includes(d))) continue;\n\n        const checkRes = await Promise.race([\n          fetchWithProxies(link.link, {\n            method: \"HEAD\",\n            headers: { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64)\" }\n          }),\n          new Promise<Response>((_, reject) => setTimeout(() => reject(new Error('timeout')), 5000))\n        ]) as Response;\n\n        if (checkRes.status === 200) {\n          validLinks.push({ title: link.title, url: link.link, source: domain, category });\n        }\n      } catch (e) { continue; }\n    }\n\n    if (validLinks.length === 0) return \"\";\n\n    // SOTA ENHANCEMENT: Use topic-aware HTML generation\n    return generateReferenceHTML(validLinks, category, keyword);\n  } catch (e) {\n    console.error('[fetchVerifiedReferences] Error:', e);\n    return \"\";\n  }\n};\n```\n\n## STEP 3: UPDATE ALL CALL SITES\n\n### Location 1: generateAndValidateReferences()\nFind around line 175\n\nCURRENT:\n```typescript\nconst generateAndValidateReferences = async (keyword: string, metaDescription: string, serperApiKey: string)\n```\n\nUPDATE TO:\n```typescript\nconst generateAndValidateReferences = async (\n  keyword: string,\n  semanticKeywords: string[],\n  serperApiKey: string,\n  wpUrl?: string\n) => {\n  return { \n    html: await fetchVerifiedReferences(keyword, semanticKeywords, serperApiKey, wpUrl), \n    data: [] \n  };\n}\n```\n\n### Location 2: In refreshItem() function (around line 820)\n\nFIND:\n```typescript\nfetchVerifiedReferences(item.title, serperApiKey, context.wpConfig.url)\n```\n\nREPLACE WITH:\n```typescript\nfetchVerifiedReferences(item.title, semanticKeywords, serperApiKey, context.wpConfig.url)\n```\n\n### Location 3: In generateItems() function (around line 910)\n\nFIND:\n```typescript\nconst { html: referencesHtml, data: referencesData } = await generateAndValidateReferences(generated.primaryKeyword, generated.metaDescription, serperApiKey);\n```\n\nREPLACE WITH:\n```typescript\nconst { html: referencesHtml, data: referencesData } = await generateAndValidateReferences(generated.primaryKeyword, generated.semanticKeywords, serperApiKey, wpConfig.url);\n```\n\n## VERIFICATION TESTS\n\n### Test 1: Fitness Content\nInput: \"Best Running Shoes 2026\"\nExpected: ACSM, NSCA, Runner's World references\n\n### Test 2: Tech Content\nInput: \"Python Machine Learning\"\nExpected: IEEE, ACM, TechCrunch references\n\n### Test 3: Business Content\nInput: \"Startup Fundraising\"\nExpected: HBR, Forbes, Bloomberg references\n\n## DEPLOYMENT\n\n1. Pull latest changes\n2. Make code replacements above (Steps 2-3)\n3. Run npm run build\n4. Test with different blog post categories\n5. Deploy to production
