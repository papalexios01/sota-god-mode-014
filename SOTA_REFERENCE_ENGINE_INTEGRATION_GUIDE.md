SOTA_REFERENCE_ENGINE_INTEGRATION_GUIDE.md# SOTA Topic-Aware Reference Engine Integration Guide\n\n## PROBLEM FIXED\n\nGeneric health references were being injected into ALL blog posts regardless of topic.\nNow fitness posts show ACSM/NSCA, tech posts show IEEE/ACM, business posts show Forbes/HBR.\n\n## NEW MODULE: src/reference-engine.ts\n\nAlready created and committed! Contains:\n\n**REFERENCE_CATEGORIES** with 6 domains:\n- health: NIH, CDC, WHO, Mayo Clinic, Healthline\n- fitness: ACSM, NSCA, Runner's World, Men's Health  \n- nutrition: Nutrition.gov, EatRight, Examine, USDA\n- technology: IEEE, ACM, TechCrunch, Wired\n- business: Harvard, Forbes, Bloomberg, WSJ, HBR\n- science: Nature, Science, ScienceDirect, PLOS\n\n## INTEGRATION TASKS\n\n### 1. Import added to services.tsx (Line 26)\n```\nimport { detectCategory, generateReferenceHTML, REFERENCE_CATEGORIES } from './reference-engine';\n```\n\n### 2. Update fetchVerifiedReferences() Function\n\nCurrent signature (around line 87):\n```\nconst fetchVerifiedReferences = async (\n  keyword: string,\n  serperApiKey: string,\n  wpUrl?: string\n```\n\nChange to:\n```\nconst fetchVerifiedReferences = async (\n  keyword: string,\n  semanticKeywords: string[],\n  serperApiKey: string,\n  wpUrl?: string\n```\n\nInside function, replace search logic with:\n```\nconst category = detectCategory(keyword, semanticKeywords);\nconst categoryConfig = REFERENCE_CATEGORIES[category];\n\nif (categoryConfig) {\n  const modifiers = categoryConfig.searchModifiers.slice(0, 2).join(' OR ');\n  const domains = categoryConfig.authorityDomains.slice(0, 3).map(d => `site:${d}`).join(' OR ');\n  query = `${keyword} \"${modifiers}\" (${domains}) 2026`;\n}\n\nreturn generateReferenceHTML(validLinks, category, keyword);\n```\n\n### 3. Update Function Calls\n\nFind all calls to fetchVerifiedReferences() and add semanticKeywords\n\nOLD:\n```\nfetchVerifiedReferences(keyword, serperApiKey, wpUrl)\n```\n\nNEW:\n```\nfetchVerifiedReferences(keyword, semanticKeywords, serperApiKey, wpUrl)\n```\n\n### 4. Update generateAndValidateReferences() \n\n```\nconst generateAndValidateReferences = async (\n  keyword: string,\n  semanticKeywords: string[],\n  serperApiKey: string,\n  wpUrl?: string\n) => {\n  return { \n    html: await fetchVerifiedReferences(keyword, semanticKeywords, serperApiKey, wpUrl), \n    data: [] \n  };\n};\n```\n\n## TEST CASES\n\nAfter integration, test:\n\n1. Fitness post - Should show ACSM, NSCA references\n2. Tech post - Should show IEEE, ACM references  \n3. Business post - Should show HBR, Forbes references\n4. Health post - Should show NIH, CDC references\n\n## CHECKLIST\n\n- [x] reference-engine.ts created\n- [x] Import added to services.tsx line 26\n- [ ] fetchVerifiedReferences() updated with semanticKeywords param\n- [ ] Category detection logic added\n- [ ] Call sites updated (refreshItem, generateItems)\n- [ ] Local testing completed\n- [ ] Commit & push\n\nDone! Ready for enterprise deployment.
